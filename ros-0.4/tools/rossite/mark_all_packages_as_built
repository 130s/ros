#!/usr/bin/env ruby
# this script crawls the ROS tree, as discovered via `rospack list`, and
# adds a blacklist file for all of those packages which don't already have one.
# the blacklist file includes a breadcrumb so that this action is reversible.

pkgs = `rospack list`.split("\n").collect{ |p| p.split(' ') }
pkgs.collect!{|p| !File.exist?(p[1]+"/ROS_NOBUILD") ? p : nil }.compact!
# now the pkgs array contains those guys which need a new ros-build-blacklist
pkgs.each do |p|
  f = File.new(p[1] + "/ROS_NOBUILD","w")
  f.puts "autogenerated by rossite to freeze build on #{Time.now}"
  f.puts "UNLIKELY_TO_OCCUR_IN_A_HUMAN_WRITTEN_NOBUILD_FILE"
  f.close
end
