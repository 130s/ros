#!/usr/bin/env ruby
# this script crawls the ROS tree, as discovered via `rospack list`, and
# adds a blacklist file for all of those packages which don't already have one.
# the blacklist file includes a breadcrumb so that this action is reversible.

pkgs = `rospack list`.split("\n").collect{ |p| p.split(' ') }
pkgs.collect!{|p| File.exist?(p[1]+"/ROS_NOBUILD") ? p : nil }.compact!
# now the pkgs array contains those guys which have a ros-build-blacklist file
pkgs.each do |p|
  text = `cat #{p[1] + "/ROS_NOBUILD"}`
  if text.include?("UNLIKELY_TO_OCCUR_IN_A_HUMAN_WRITTEN_NOBUILD_FILE")
    File.delete(p[1] + "/ROS_NOBUILD")
  end
#  f = File.new(p[1] + "/ROS_BUILD_BLACKLIST","r")
#  f.puts "autogenerated by rossite to freeze build on #{Time.now}"
#  f.puts "EXTREMELY_UNLIKELY_TO_OCCUR_IN_A_HUMAN_WRITTEN_BLACKLIST_FILE"
#  f.close
end
